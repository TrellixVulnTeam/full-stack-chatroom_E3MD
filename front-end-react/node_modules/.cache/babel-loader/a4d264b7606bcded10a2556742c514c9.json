{"ast":null,"code":"var _jsxFileName = \"/Users/kitan/Documents/CODING/Long-term-projects/group-chat-react-project/group-chat-react/src/Chatroom/ChatRoom.js\";\nimport './Chatroom.css';\nimport { withRouter } from 'react-router-dom';\nimport React from 'react';\nimport io from 'socket.io-client';\nimport autosize from \"autosize\";\nimport ChatMessage from './ChatMessage';\nimport SocketManager from './Socket';\nimport Message from '../Models/MessageModel';\nimport { FaTelegramPlane } from \"react-icons/fa\";\nimport { Modal, Button } from 'antd';\nimport { UserService } from '../FirebaseUtil/UserService';\nimport { FirebaseUtil } from '../FirebaseUtil/FirebaseUtil';\nimport User from '../Models/UserModel'; // \"bnh5yzdirjinqaorq0ox1tf383nb3xr\"\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Chat extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      room: null,\n      user: null,\n      isAdmin: \"\",\n      newMessage: \"\",\n      messages: [],\n      status: \"\",\n      messageOptionsIsVisible: false,\n      render: false\n    }; ////bind functions\n\n    this.textarea = /*#__PURE__*/_jsxDEV(\"textarea\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 25\n    }, this);\n    this.removeMessage = this.removeMessage.bind(this);\n    this.onAddReaction = this.onAddReaction.bind(this);\n    this.showMessageOptions = this.showMessageOptions.bind(this); //other variables\n\n    this.MaxMessageLength = 140;\n    this.socket = null;\n    this.room = null; //})()\n  }\n\n  componentDidMount() {\n    //query parameters\n    let queryParams = {};\n\n    try {\n      let searchString = this.props.history.location.search.substring(1).split('&');\n      let pair = [];\n\n      for (var i = 0; i < searchString.length; i++) {\n        pair = searchString[i].split('=');\n        queryParams[pair[0]] = pair[1];\n      }\n\n      if (!queryParams.room) return this.setState({\n        status: \"404\"\n      });\n    } catch (err) {\n      console.log(\"query param err: \", err);\n      this.setState({\n        status: \"404\"\n      });\n      return;\n    }\n    /*FirebaseUtil.findRoom(roomCode).then(doc =>{\n        console.log(doc.data())\n    })*/\n\n\n    (async () => {\n      /////find room\n      let room;\n      if (this.props.location.state) room = this.props.location.state.room;else {\n        room = await FirebaseUtil.findRoomById(queryParams.room);\n        console.log(room);\n      }\n\n      if (!room) {\n        this.setState({\n          status: \"404\"\n        });\n        this.setState({\n          render: true\n        });\n        return;\n      }\n\n      this.room = room; //set state\n\n      this.setState({\n        room: room,\n        user: this.props.data.user,\n        isAdmin: room.adminID == UserService.token(),\n        newMessage: \"\",\n        messages: [],\n        status: \"200\",\n        messageOptionsIsVisible: false,\n        render: true\n      }); //if(!this.state.room)this.props.history.push(\"/\")\n\n      if (true) {\n        this.connectSocket();\n        this.socketEvents();\n      } //http://localhost:3000/chat?=Yu9uIlEncb8flTfFxv14.focus();\n\n\n      autosize(this.textarea);\n      console.log(this.state);\n    })();\n    /*console.log(\"did mount.\")\n    if(this.state.status == \"404\"){\n        //this.props.history.push(\"/\")\n        //return\n        return\n    }else if(this.state.render){\n         //if(!this.state.room)this.props.history.push(\"/\")\n        if(true){\n            this.connectSocket()\n            this.socketEvents()\n        }\n        //http://localhost:3000/chat?=Yu9uIlEncb8flTfFxv14.focus();\n        autosize(this.textarea);\n    }*/\n\n  }\n\n  componentDidUpdate(previousProps, previousState) {\n    console.log(previousProps, previousState);\n\n    if (this.state.render) {\n      //if(!this.state.room)this.props.history.push(\"/\")\n      if (true) {\n        this.connectSocket();\n        this.socketEvents();\n      } //http://localhost:3000/chat?=Yu9uIlEncb8flTfFxv14.focus();\n\n\n      autosize(this.textarea);\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (prevProps.myProps !== this.props.myProp) {// this.props.myProp has a different value\n      // ...\n    }\n  }\n\n  connectSocket() {\n    this.socket = io(\"http://192.168.1.9:1234\", {\n      transport: ['websocket']\n    });\n  }\n\n  set(field, value) {\n    this.setState({\n      [field]: value\n    });\n  }\n\n  socketEvents() {\n    //socket functions\n    this.socket.on('connect', connection => {\n      if (this.state.isAdmin) {\n        SocketManager.createRoom(this);\n      } else {\n        this.socket.emit('join-room', this.room.roomCode, UserService.token());\n      }\n\n      console.log(\"connected.\");\n      this.socket.on('generated-user-token', tkn => {\n        this.props.data.persistentToken = tkn;\n        localStorage.setItem(\"persistentToken\", tkn);\n        console.log(\"new token generated: \", tkn);\n      });\n      this.socket.on('backlog-messages', messages_ => {\n        this.set(\"messages\", messages_);\n        this.set(\"status\", \"loaded\");\n        console.log(\"backlog: \", messages_);\n      });\n      this.socket.on('broadcasted-message', message => {\n        this.set(\"messages\", [...this.state.messages, message]);\n      });\n      this.socket.on('room-ended', () => {\n        console.log(\"room ended. \");\n        this.socket.close();\n        this.detachFromRoom();\n      });\n      this.socket.on('removed-message', messages_ => {\n        this.set(\"messages\", messages_);\n        console.log(\"messages updated: \", messages_);\n      });\n      this.socket.on('update-message', messages_ => {\n        this.set(\"messages\", messages_);\n        console.log(\"messages updated: \", messages_);\n      });\n      this.socket.on('find-and-ban-user', token => {\n        console.log(\"user has been banned.\");\n        console.log(token === this.props.data.persistentToken);\n        console.log(token, this.props.data.persistentToken);\n\n        if (token === this.props.data.persistentToken) {\n          this.detachFromRoom();\n          this.set(\"status\", \"banned\");\n        }\n      });\n    });\n  }\n\n  setValue(setter, event) {\n    this.set(setter, event.target.value);\n  }\n\n  updateNewMessage(event) {\n    console.log(event.target.value, event.target.value.length, event.target.value.substring(0, this.MaxMessageLength));\n    if (event.target.value.length > this.MaxMessageLength) return this.set(\"newMessage\", event.target.value.substring(0, this.MaxMessageLength));\n    this.set(\"newMessage\", event.target.value);\n  }\n\n  sendMessage() {\n    let msg = new Message(this.state.room.roomCode, this.state.newMessage, this.state.user.userName, UserService.token()); //this.socket.emit(\"broadcast-message\", this.state.room.roomCode, this.state.newMessage, this.state.user.userName, this.props.data.persistentToken)\n\n    this.socket.emit(\"broadcast-message\", this.state.room.roomCode, msg);\n    this.set(\"newMessage\", \"\");\n  }\n\n  endRoom() {\n    this.socket.emit(\"end-room\", this.state.room.roomCode);\n    this.detachFromRoom();\n  }\n\n  detachFromRoom() {\n    this.set(\"room\", null);\n    this.socket.close();\n    this.socket = null;\n    this.set(\"status\", \"closed\");\n  }\n\n  leaveRoom() {\n    this.socket.emit(\"leave-room\", this.roomCode);\n    this.detachFromRoom();\n    this.props.history.push(\"/\");\n  }\n\n  removeUser(msg) {}\n\n  exitClosedRoom() {\n    this.props.history.push(\"/\");\n  }\n\n  removeMessage(msg) {\n    alert(\"user will be banned\");\n    console.log(msg, this.state.room.roomCode, msg);\n    this.socket.emit(\"ban-user\", this.state.room.roomCode, msg);\n  }\n\n  onAddReaction(emoji, msg) {\n    this.socket.emit(\"add-reaction\", this.state.room.roomCode, msg, emoji);\n  }\n\n  closeMessageOptions() {\n    this.setState({\n      messageOptionsIsVisible: false\n    });\n  }\n\n  showMessageOptions(msg) {\n    console.log(msg);\n    this.setState({\n      messageOptionsIsVisible: true\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      class: \"page-root chatroom-root\",\n      children: [!this.state.render ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"Loading\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 38\n      }, this) : null, this.state.render && this.state.status == \"404\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"STATUS 404\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 65\n      }, this) : null, this.state.render && this.state.status == \"200\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [\" \", this.state.room && this.state.status !== \"closed\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n          class: \"chatroom-view\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"title-view\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              class: \"title-text\",\n              children: this.state.room.roomName\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 331,\n              columnNumber: 29\n            }, this), this.state.isAdmin ? /*#__PURE__*/_jsxDEV(\"span\", {\n              class: \"leave-text\",\n              children: \"end\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 337,\n              columnNumber: 33\n            }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n              class: \"leave-text\",\n              children: \"leave\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 338,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 329,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"chatroom-messages-view\",\n            children: this.state.messages ? /*#__PURE__*/_jsxDEV(\"div\", {\n              children: this.state.messages.map(msg => /*#__PURE__*/_jsxDEV(ChatMessage, {\n                onClick: () => this.showMessageOptions(msg),\n                onReportMessage: this.removeMessage,\n                message: msg,\n                text: msg.message,\n                userName: msg.userName,\n                reactions: msg.reactions,\n                onAddReaction: emoji => this.onAddReaction(emoji, msg),\n                isUser: UserService.token() === msg.userToken\n              }, msg.messageID, false, {\n                fileName: _jsxFileName,\n                lineNumber: 349,\n                columnNumber: 33\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 347,\n              columnNumber: 29\n            }, this) : null\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 344,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"typed-message-view\",\n            children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n              class: \"typed-message-input\",\n              ref: c => this.textarea = c,\n              rows: 3,\n              defaultValue: \"\",\n              value: this.state.newMessage,\n              onChange: this.updateNewMessage.bind(this),\n              class: \"typed-message-input\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 366,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n              class: \"material-icons send-message-btn\",\n              onClick: this.sendMessage.bind(this),\n              children: /*#__PURE__*/_jsxDEV(FaTelegramPlane, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 379,\n                columnNumber: 34\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 377,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"character-count\",\n              children: [this.state.newMessage.length, \"/\", this.MaxMessageLength]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 380,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 365,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 25\n        }, this) : null, this.state.status === \"closed\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            class: \"title-leave-btn\",\n            onClick: this.exitClosedRoom.bind(this),\n            children: \"leave\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 389,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \" room is closed.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 390,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 388,\n          columnNumber: 21\n        }, this) : null, this.state.status === \"banned\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            class: \"title-leave-btn\",\n            onClick: this.exitClosedRoom.bind(this),\n            children: \"leave\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \" you've been removed.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 398,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 396,\n          columnNumber: 21\n        }, this) : null, /*#__PURE__*/_jsxDEV(Modal, {\n          width: \"80%\",\n          visible: this.state.messageOptionsIsVisible,\n          onCancel: this.closeMessageOptions.bind(this),\n          footer: null,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"message-info-modal\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              children: \" Remove User\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 406,\n              columnNumber: 25\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 405,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 404,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 21\n      }, this) : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 322,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default _c = withRouter(Chat);\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["/Users/kitan/Documents/CODING/Long-term-projects/group-chat-react-project/group-chat-react/src/Chatroom/ChatRoom.js"],"names":["withRouter","React","io","autosize","ChatMessage","SocketManager","Message","FaTelegramPlane","Modal","Button","UserService","FirebaseUtil","User","Chat","Component","constructor","props","state","room","user","isAdmin","newMessage","messages","status","messageOptionsIsVisible","render","textarea","removeMessage","bind","onAddReaction","showMessageOptions","MaxMessageLength","socket","componentDidMount","queryParams","searchString","history","location","search","substring","split","pair","i","length","setState","err","console","log","findRoomById","data","adminID","token","connectSocket","socketEvents","componentDidUpdate","previousProps","previousState","prevProps","myProps","myProp","transport","set","field","value","on","connection","createRoom","emit","roomCode","tkn","persistentToken","localStorage","setItem","messages_","message","close","detachFromRoom","setValue","setter","event","target","updateNewMessage","sendMessage","msg","userName","endRoom","leaveRoom","push","removeUser","exitClosedRoom","alert","emoji","closeMessageOptions","roomName","map","reactions","userToken","messageID","c"],"mappings":"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","sourcesContent":["import './Chatroom.css';\nimport { withRouter} from 'react-router-dom';\n\nimport React from 'react';\nimport io from 'socket.io-client';\nimport autosize from \"autosize\";\n\n\n\nimport ChatMessage from './ChatMessage';\nimport SocketManager from './Socket'\nimport Message from '../Models/MessageModel'\n\nimport { FaTelegramPlane } from \"react-icons/fa\";\nimport { Modal, Button } from 'antd';\nimport { UserService } from '../FirebaseUtil/UserService';\nimport { FirebaseUtil } from '../FirebaseUtil/FirebaseUtil';\nimport User from '../Models/UserModel';\n\n\n\n\n\n\n\n// \"bnh5yzdirjinqaorq0ox1tf383nb3xr\"\n\nclass Chat extends React.Component{\n\n\n    constructor(props){\n\n        super(props)\n\n        this.state = {\n            room: null,\n            user: null,\n            isAdmin: \"\",\n            newMessage: \"\",\n            messages: [],\n            status: \"\",\n            messageOptionsIsVisible: false,\n            render:false\n        }\n\n        ////bind functions\n        this.textarea = <textarea/>\n        this.removeMessage =this.removeMessage.bind(this)\n        this.onAddReaction = this.onAddReaction.bind(this)\n        this.showMessageOptions = this.showMessageOptions.bind(this)\n\n        //other variables\n        this.MaxMessageLength = 140;\n        this.socket = null; \n        this.room = null;\n\n\n        \n\n\n\n     //})()\n\n        \n    }\n\n    \n    componentDidMount(){\n\n                //query parameters\n                let queryParams = {}\n                try{\n                    let searchString = this.props.history.location.search.substring(1).split('&')\n                    let pair = []\n        \n                    for(var i=0;i<searchString.length;i++){\n                        pair = searchString[i].split('=')\n                        queryParams[pair[0]] = pair[1]\n                    }\n        \n                    if(!queryParams.room)  return this.setState({status: \"404\"})\n                }catch(err){\n                    console.log(\"query param err: \", err)\n                    this.setState({status: \"404\"})\n                    return\n                    \n                }\n            \n                /*FirebaseUtil.findRoom(roomCode).then(doc =>{\n                    console.log(doc.data())\n                })*/\n        \n        \n                ( async() => {\n                /////find room\n                let room ;\n              \n                if(this.props.location.state) room = this.props.location.state.room\n                else{\n                    room = await FirebaseUtil.findRoomById(queryParams.room)\n                    console.log(room)\n                } \n                if(!room){\n                    this.setState({status: \"404\"})\n                    this.setState({render: true})\n                    return\n                }\n        \n                this.room = room;\n                //set state\n                this.setState({\n                    room: room,\n                    user: this.props.data.user,\n                    isAdmin: room.adminID == UserService.token(),\n                    newMessage: \"\",\n                    messages: [],\n                    status: \"200\",\n                    messageOptionsIsVisible: false,\n                    render:true\n                })\n\n                         //if(!this.state.room)this.props.history.push(\"/\")\n            if(true){\n                this.connectSocket()\n                this.socketEvents()\n            }\n            //http://localhost:3000/chat?=Yu9uIlEncb8flTfFxv14.focus();\n            autosize(this.textarea);\n\n            console.log(this.state)\n        \n        })()\n\n        /*console.log(\"did mount.\")\n        if(this.state.status == \"404\"){\n            //this.props.history.push(\"/\")\n            //return\n            return\n       }else if(this.state.render){\n\n            //if(!this.state.room)this.props.history.push(\"/\")\n            if(true){\n                this.connectSocket()\n                this.socketEvents()\n            }\n            //http://localhost:3000/chat?=Yu9uIlEncb8flTfFxv14.focus();\n            autosize(this.textarea);\n        }*/\n    }\n\n    componentDidUpdate(previousProps, previousState){\n\n        console.log(previousProps, previousState)\n        if(this.state.render){\n\n            //if(!this.state.room)this.props.history.push(\"/\")\n            if(true){\n                this.connectSocket()\n                this.socketEvents()\n            }\n            //http://localhost:3000/chat?=Yu9uIlEncb8flTfFxv14.focus();\n            autosize(this.textarea);\n        }\n    }\n\n\n\n    componentDidUpdate(prevProps) {\n        if(prevProps.myProps !== this.props.myProp) {\n          // this.props.myProp has a different value\n          // ...\n        }\n      }\n\n    connectSocket(){\n        this.socket = io(\"http://192.168.1.9:1234\", { transport: ['websocket']}) ;\n    }\n\n\n    set(field, value){\n        this.setState({[field]: value})\n    }\n\n    socketEvents(){\n\n        \n        //socket functions\n        this.socket.on('connect', (connection) => {\n           \n            if(this.state.isAdmin){\n                SocketManager.createRoom(this)\n            }else{\n                this.socket.emit('join-room', this.room.roomCode,  UserService.token())\n            }\n            console.log(\"connected.\")\n\n            this.socket.on('generated-user-token', (tkn) => {\n                this.props.data.persistentToken = tkn;\n                localStorage.setItem(\"persistentToken\", tkn)\n                console.log(\"new token generated: \",tkn)\n            });\n\n\n            this.socket.on('backlog-messages', (messages_) => {\n                this.set(\"messages\",messages_ )\n                this.set(\"status\", \"loaded\")\n                console.log(\"backlog: \", messages_)\n\n            });\n\n            this.socket.on('broadcasted-message', (message) => {\n                this.set(\"messages\", [...this.state.messages,message])\n            });\n\n            this.socket.on('room-ended', () => {\n                console.log(\"room ended. \")\n                this.socket.close()\n                this.detachFromRoom()\n            });\n\n            this.socket.on('removed-message', (messages_) => {\n                this.set(\"messages\",messages_ )\n                console.log(\"messages updated: \", messages_)\n            });\n\n            this.socket.on('update-message', (messages_) => {\n                this.set(\"messages\",messages_ )\n                console.log(\"messages updated: \", messages_)\n            });\n\n            this.socket.on('find-and-ban-user', (token) => {\n                console.log(\"user has been banned.\")\n                console.log(token === this.props.data.persistentToken)\n                console.log(token, this.props.data.persistentToken)\n\n                \n                if(token === this.props.data.persistentToken){\n                    this.detachFromRoom();\n                    this.set(\"status\",\"banned\" )\n\n                }\n            });\n\n        });\n\n   \n\n\n\n    }\n\n    setValue(setter, event){\n        this.set(setter, event.target.value)\n    }\n\n    updateNewMessage(event){\n\n        console.log(event.target.value, event.target.value.length, event.target.value.substring(0,this.MaxMessageLength))\n        if(event.target.value.length>this.MaxMessageLength)return this.set(\"newMessage\" ,event.target.value.substring(0,this.MaxMessageLength))\n        this.set(\"newMessage\" ,event.target.value)\n    }\n\n    sendMessage(){\n        let msg = new Message(this.state.room.roomCode, this.state.newMessage, this.state.user.userName, UserService.token())\n        //this.socket.emit(\"broadcast-message\", this.state.room.roomCode, this.state.newMessage, this.state.user.userName, this.props.data.persistentToken)\n        this.socket.emit(\"broadcast-message\", this.state.room.roomCode, msg)\n        this.set(\"newMessage\", \"\")\n    }\n\n    endRoom(){\n        this.socket.emit(\"end-room\", this.state.room.roomCode)\n        this.detachFromRoom()\n    }\n\n    detachFromRoom(){\n        this.set(\"room\",null)\n        this.socket.close()\n        this.socket = null;\n        this.set(\"status\", \"closed\")\n    }\n\n    leaveRoom(){\n        this.socket.emit(\"leave-room\", this.roomCode)\n        this.detachFromRoom();\n        this.props.history.push(\"/\")\n    }\n\n    removeUser(msg){\n       \n        \n    }\n    \n    exitClosedRoom(){\n        this.props.history.push(\"/\")\n    }\n\n    removeMessage(msg){\n        alert(\"user will be banned\")\n        console.log(msg,  this.state.room.roomCode, msg)\n        this.socket.emit(\"ban-user\", this.state.room.roomCode, msg)\n    }\n\n    onAddReaction(emoji, msg){\n        this.socket.emit(\"add-reaction\", this.state.room.roomCode, msg, emoji)\n    }\n\n    closeMessageOptions(){\n        this.setState({messageOptionsIsVisible: false})\n    }\n\n\n    showMessageOptions(msg){\n        console.log(msg)\n        this.setState({messageOptionsIsVisible: true})\n    }\n\n  \n    render(){\n\n        return (\n            \n            <div class=\"page-root chatroom-root\">\n                {!this.state.render? <div>Loading</div>:null}\n                {this.state.render && this.state.status==\"404\"? <div>STATUS 404</div>:null}\n                {this.state.render && this.state.status==\"200\"?\n                    <div> {this.state.room && this.state.status !== \"closed\" ?\n                        <div class=\"chatroom-view\">\n                        \n                        <div class=\"title-view\">\n            \n                            <span class=\"title-text\">{this.state.room.roomName}</span>\n                            {/*this.state.isAdmin?\n                                <p class=\"title-leave-btn\"  onClick={this.endRoom.bind(this)}>end room</p>:\n                                <p class=\"title-leave-btn\"  onClick={this.leaveRoom.bind(this)}>leave</p>\n                            */ }\n                        {this.state.isAdmin?\n                                <span class=\"leave-text\">end</span>:\n                                <span class=\"leave-text\">leave</span>\n                        }\n\n                \n                        </div>\n                    \n                        <div class=\"chatroom-messages-view\">\n                    \n                            {this.state.messages?\n                            <div>\n                                {this.state.messages.map(msg=> \n                                <ChatMessage \n                                    onClick={()=> this.showMessageOptions(msg)} \n                                    onReportMessage={this.removeMessage}\n                                    message ={msg}\n                                    key={msg.messageID} \n                                    text={msg.message} \n                                    userName={msg.userName } \n                                    reactions = {msg.reactions}\n                                    onAddReaction={(emoji=>this.onAddReaction(emoji, msg))}\n                                    isUser={UserService.token()=== msg.userToken }/>)}\n                            </div>\n                                :null\n                            }\n                \n                            </div>\n\n                            <div class=\"typed-message-view\">\n                            <textarea\n                                class=\"typed-message-input\"\n                                ref={c => (this.textarea = c)}\n                                rows={3}\n                                defaultValue=\"\"\n                                value={this.state.newMessage} \n                                onChange={this.updateNewMessage.bind(this) }\n                                class=\"typed-message-input\"\n                                />\n            \n                            \n                                <i class=\"material-icons send-message-btn\" \n                                    onClick={this.sendMessage.bind(this)}\n                                ><FaTelegramPlane/></i>\n                                <span className=\"character-count\">{this.state.newMessage.length}/{this.MaxMessageLength}</span>\n                            </div>\n                \n                        </div>\n                        :null\n                    }\n\n                    {this.state.status === \"closed\"?\n                    <div>\n                        <p class=\"title-leave-btn\"  onClick={this.exitClosedRoom.bind(this)}>leave</p>\n                        <p> room is closed.</p>\n                    </div>:\n                        null\n                    }\n\n                    {this.state.status === \"banned\"?\n                    <div>\n                        <p class=\"title-leave-btn\"  onClick={this.exitClosedRoom.bind(this)}>leave</p>\n                        <p> you've been removed.</p>\n                    </div>:\n                        null\n                    }\n\n\n                    <Modal  width=\"80%\" visible={this.state.messageOptionsIsVisible}  onCancel={this.closeMessageOptions.bind(this)} footer={null}>\n                        <div className=\"message-info-modal\">\n                        <button > Remove User</button>\n                        </div>\n                        \n                    </Modal>\n\n\n\n\n\n                    </div>\n\n                    :null\n                }\n\n            </div>\n\n\n\n\n\n\n        );\n\n        \n    }\n    \n}\n\nexport default withRouter(Chat);\n"]},"metadata":{},"sourceType":"module"}