{"ast":null,"code":"//FIREBASE CONFIG//\nimport firebase from 'firebase';\nimport 'firebase/firestore';\nvar firebaseConfig = {\n  apiKey: process.env.REACT_APP_apiKey,\n  authDomain: process.env.REACT_APP_authDomain,\n  projectId: process.env.REACT_APP_projectId,\n  storageBucket: process.env.REACT_APP_storageBucket,\n  messagingSenderId: process.env.REACT_APP_messagingSenderId,\n  appId: process.env.REACT_APP_appId,\n  measurementId: process.env.REACT_APP_measurementId\n};\nfirebase.initializeApp(firebaseConfig); //DATABASE INIT\n\nconst firestore = firebase.firestore();\nvar database = firebase.database();\nconst chatroomsDB = firestore.collection('chatrooms');\nconst usersDB = firestore.collection('users'); //const messagesRef = firestore.collection('messages');\n//Functional groups\n\nclass FirebaseUtil {\n  static async getUserToken() {\n    if (!localStorage.getItem(\"user-token\")) {\n      let userID = await usersDB.add({\n        name: \"none\",\n        type: \"annon\"\n      }).then(res => {\n        localStorage.setItem(\"user-token\", res.id);\n        console.log(\"generating new profile: \", res.id);\n        return res.id;\n      });\n      return userID;\n    } else {\n      console.log(\"returning user: \", localStorage.getItem(\"user-token\"));\n      return localStorage.getItem(\"user-token\");\n    }\n  }\n\n  static async createRoom(userName, adminId, roomName) {\n    let code = 25;\n    chatroomsDB.get().then(querySnapshot => {\n      let duplicatedCode = null;\n\n      while (!duplicatedCode) {\n        querySnapshot.docs.forEach(doc => console.log(doc));\n        duplicatedCode = querySnapshot.docs.find(doc => doc.data().code == code);\n        console.log(\"code is duplicated: \", code);\n        code++;\n      }\n\n      console.log(\"code is not duplicated: \", code);\n      return code;\n      /*if(querySnapshot.exists){\n          code++\n          return true\n      }else{\n          return false\n      }*/\n    }).catch(error => {\n      console.log(\"Error getting documents: \", error);\n    });\n    const apiCompletionPromise = chatroomsDB.add({\n      admin: userName,\n      adminId: adminId,\n      roomName: roomName,\n      type: \"temporary\",\n      timeStamp: \"\" //firestore.FieldValue.serverTimestamp()\n\n    });\n    return apiCompletionPromise;\n  }\n\n}\n\nexport { FirebaseUtil };\n\nfunction rand() {\n  return Math.random().toString(36).substr(2); // remove `0.`\n}\n\n;\n\nfunction newToken() {\n  return rand() + rand(); // to make it longer\n}\n\n;\n\nfunction newCode() {\n  let code = Math.floor(Math.random() * 1000000 + 1);\n  ; // to make it longer\n\n  while (rooms[code]) {\n    code = Math.floor(Math.random() * 1000000 + 1);\n  }\n\n  return code;\n}\n\n;","map":{"version":3,"sources":["/Users/kitan/Documents/CODING/Long-term-projects/group-chat-react-project/group-chat-react/src/FirebaseUtil/FirebaseUtil.js"],"names":["firebase","firebaseConfig","apiKey","process","env","REACT_APP_apiKey","authDomain","REACT_APP_authDomain","projectId","REACT_APP_projectId","storageBucket","REACT_APP_storageBucket","messagingSenderId","REACT_APP_messagingSenderId","appId","REACT_APP_appId","measurementId","REACT_APP_measurementId","initializeApp","firestore","database","chatroomsDB","collection","usersDB","FirebaseUtil","getUserToken","localStorage","getItem","userID","add","name","type","then","res","setItem","id","console","log","createRoom","userName","adminId","roomName","code","get","querySnapshot","duplicatedCode","docs","forEach","doc","find","data","catch","error","apiCompletionPromise","admin","timeStamp","rand","Math","random","toString","substr","newToken","newCode","floor","rooms"],"mappings":"AACA;AACA,OAAOA,QAAP,MAAqB,UAArB;AACA,OAAO,oBAAP;AAGA,IAAIC,cAAc,GAAG;AACjBC,EAAAA,MAAM,EAAEC,OAAO,CAACC,GAAR,CAAYC,gBADH;AAEjBC,EAAAA,UAAU,EAAEH,OAAO,CAACC,GAAR,CAAYG,oBAFP;AAGjBC,EAAAA,SAAS,EAAEL,OAAO,CAACC,GAAR,CAAYK,mBAHN;AAIjBC,EAAAA,aAAa,EAAEP,OAAO,CAACC,GAAR,CAAYO,uBAJV;AAKjBC,EAAAA,iBAAiB,EAAET,OAAO,CAACC,GAAR,CAAYS,2BALd;AAMjBC,EAAAA,KAAK,EAAEX,OAAO,CAACC,GAAR,CAAYW,eANF;AAOjBC,EAAAA,aAAa,EAAEb,OAAO,CAACC,GAAR,CAAYa;AAPV,CAArB;AAUAjB,QAAQ,CAACkB,aAAT,CAAuBjB,cAAvB,E,CAGA;;AACA,MAAMkB,SAAS,GAAGnB,QAAQ,CAACmB,SAAT,EAAlB;AACA,IAAIC,QAAQ,GAAGpB,QAAQ,CAACoB,QAAT,EAAf;AAEA,MAAMC,WAAW,GAAGF,SAAS,CAACG,UAAV,CAAqB,WAArB,CAApB;AACA,MAAMC,OAAO,GAAGJ,SAAS,CAACG,UAAV,CAAqB,OAArB,CAAhB,C,CACA;AAGA;;AACA,MAAME,YAAN,CAAoB;AAEU,eAAZC,YAAY,GAAE;AAEtB,QAAG,CAACC,YAAY,CAACC,OAAb,CAAqB,YAArB,CAAJ,EAAuC;AAEnC,UAAIC,MAAM,GAAG,MAAML,OAAO,CAACM,GAAR,CAAY;AAC3BC,QAAAA,IAAI,EAAE,MADqB;AAE3BC,QAAAA,IAAI,EAAE;AAFqB,OAAZ,EAGhBC,IAHgB,CAGXC,GAAG,IAAG;AACVP,QAAAA,YAAY,CAACQ,OAAb,CAAqB,YAArB,EAAmCD,GAAG,CAACE,EAAvC;AACAC,QAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ,EAAwCJ,GAAG,CAACE,EAA5C;AACA,eAAOF,GAAG,CAACE,EAAX;AACH,OAPkB,CAAnB;AASA,aAAOP,MAAP;AAEH,KAbD,MAaK;AACCQ,MAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAAgCX,YAAY,CAACC,OAAb,CAAqB,YAArB,CAAhC;AACA,aAAOD,YAAY,CAACC,OAAb,CAAqB,YAArB,CAAP;AACL;AACN;;AAEsB,eAAVW,UAAU,CAACC,QAAD,EAAWC,OAAX,EAAoBC,QAApB,EAA6B;AAEhD,QAAIC,IAAI,GAAG,EAAX;AACArB,IAAAA,WAAW,CAACsB,GAAZ,GAAkBX,IAAlB,CAAwBY,aAAD,IAAmB;AAEtC,UAAIC,cAAc,GAAG,IAArB;;AACA,aAAM,CAACA,cAAP,EAAsB;AAClBD,QAAAA,aAAa,CAACE,IAAd,CAAmBC,OAAnB,CAA2BC,GAAG,IAAIZ,OAAO,CAACC,GAAR,CAAYW,GAAZ,CAAlC;AACAH,QAAAA,cAAc,GAAGD,aAAa,CAACE,IAAd,CAAmBG,IAAnB,CAAwBD,GAAG,IAAKA,GAAG,CAACE,IAAJ,EAAD,CAAaR,IAAb,IAAqBA,IAApD,CAAjB;AACAN,QAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ,EAAmCK,IAAnC;AACAA,QAAAA,IAAI;AAEP;;AAEDN,MAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ,EAAuCK,IAAvC;AAEA,aAAOA,IAAP;AACI;AAChB;AACA;AACA;AACA;AACA;AAGS,KAtBD,EAuBKS,KAvBL,CAuBYC,KAAD,IAAW;AACdhB,MAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ,EAAyCe,KAAzC;AACH,KAzBL;AA4BA,UAAMC,oBAAoB,GAAGhC,WAAW,CAACQ,GAAZ,CAAgB;AACzCyB,MAAAA,KAAK,EAAEf,QADkC;AAEzCC,MAAAA,OAAO,EAAEA,OAFgC;AAGzCC,MAAAA,QAAQ,EAAEA,QAH+B;AAIzCV,MAAAA,IAAI,EAAE,WAJmC;AAKzCwB,MAAAA,SAAS,EAAE,EAL8B,CAK5B;;AAL4B,KAAhB,CAA7B;AASA,WAAOF,oBAAP;AAEL;;AAjEiB;;AAwEpB,SACI7B,YADJ;;AAIA,SAASgC,IAAT,GAAiB;AACb,SAAOC,IAAI,CAACC,MAAL,GAAcC,QAAd,CAAuB,EAAvB,EAA2BC,MAA3B,CAAkC,CAAlC,CAAP,CADa,CACgC;AAC9C;;AAAA;;AAED,SAASC,QAAT,GAAoB;AAClB,SAAOL,IAAI,KAAKA,IAAI,EAApB,CADkB,CACM;AACzB;;AAAA;;AAED,SAASM,OAAT,GAAmB;AACjB,MAAIpB,IAAI,GAAGe,IAAI,CAACM,KAAL,CAAYN,IAAI,CAACC,MAAL,KAAc,OAAf,GAAwB,CAAnC,CAAX;AAAiD,GADhC,CACkC;;AACnD,SAAMM,KAAK,CAACtB,IAAD,CAAX,EAAkB;AAChBA,IAAAA,IAAI,GAAGe,IAAI,CAACM,KAAL,CAAYN,IAAI,CAACC,MAAL,KAAc,OAAf,GAAwB,CAAnC,CAAP;AACD;;AAED,SAAOhB,IAAP;AACD;;AAAA","sourcesContent":["\n//FIREBASE CONFIG//\nimport firebase from 'firebase';\nimport 'firebase/firestore';\n\n\nvar firebaseConfig = {\n    apiKey: process.env.REACT_APP_apiKey,\n    authDomain: process.env.REACT_APP_authDomain,\n    projectId: process.env.REACT_APP_projectId,\n    storageBucket: process.env.REACT_APP_storageBucket,\n    messagingSenderId: process.env.REACT_APP_messagingSenderId,\n    appId: process.env.REACT_APP_appId,\n    measurementId: process.env.REACT_APP_measurementId\n};\n  \nfirebase.initializeApp(firebaseConfig)\n\n\n//DATABASE INIT\nconst firestore = firebase.firestore();\nvar database = firebase.database();\n\nconst chatroomsDB = firestore.collection('chatrooms');\nconst usersDB = firestore.collection('users');\n//const messagesRef = firestore.collection('messages');\n\n\n//Functional groups\nclass FirebaseUtil  {\n\n     static async getUserToken(){\n\n          if(!localStorage.getItem(\"user-token\")){\n  \n              let userID = await usersDB.add({\n                  name: \"none\",\n                  type: \"annon\"\n              }).then(res =>{\n                  localStorage.setItem(\"user-token\", res.id)\n                  console.log(\"generating new profile: \", res.id)\n                  return res.id\n              })\n\n              return userID\n\n          }else{\n                console.log(\"returning user: \", localStorage.getItem(\"user-token\"))\n                return localStorage.getItem(\"user-token\");\n          }\n    }\n    \n    static async createRoom(userName, adminId, roomName){\n\n        let code = 25;\n        chatroomsDB.get().then((querySnapshot) => {\n\n            let duplicatedCode = null;\n            while(!duplicatedCode){\n                querySnapshot.docs.forEach(doc => console.log(doc))\n                duplicatedCode = querySnapshot.docs.find(doc => (doc.data()).code == code)\n                console.log(\"code is duplicated: \",code)\n                code++;\n                \n            }\n\n            console.log(\"code is not duplicated: \",code)\n\n            return code;\n                /*if(querySnapshot.exists){\n                    code++\n                    return true\n                }else{\n                    return false\n                }*/\n                \n              \n        })\n            .catch((error) => {\n                console.log(\"Error getting documents: \", error);\n            })\n        \n\n        const apiCompletionPromise = chatroomsDB.add({\n            admin: userName,\n            adminId: adminId,\n            roomName: roomName,\n            type: \"temporary\",\n            timeStamp: \"\"//firestore.FieldValue.serverTimestamp()\n\n        })\n\n        return apiCompletionPromise\n\n  }\n\n\n\n}\n\n\nexport {\n    FirebaseUtil\n}\n\nfunction rand () {\n    return Math.random().toString(36).substr(2); // remove `0.`\n  };\n  \n  function newToken() {\n    return rand() + rand(); // to make it longer\n  };\n  \n  function newCode() {\n    let code = Math.floor((Math.random()*1000000)+1);; // to make it longer\n    while(rooms[code]){\n      code = Math.floor((Math.random()*1000000)+1);\n    }\n  \n    return code;\n  };"]},"metadata":{},"sourceType":"module"}