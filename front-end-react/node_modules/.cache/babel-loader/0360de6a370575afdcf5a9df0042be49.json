{"ast":null,"code":"var _jsxFileName = \"/Users/kitan/Documents/CODING/group-chat-react-project/group-chat-react/src/Chatroom/ChatRoom.js\";\nimport './chatroom.css';\nimport Room from './RoomModel';\nimport Message from './MessageModel';\nimport React, { useState, useEffect } from 'react';\nimport io from 'socket.io-client';\nimport ChatMessage from './ChatMessage'; // \"bnh5yzdirjinqaorq0ox1tf383nb3xr\"\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Chat extends React.Component {\n  constructor(props) {\n    super(props);\n    this.socket = null;\n    let room_ = props.data.room; //new Room(\"25\", \"love isalnd ❤️\", \"kit\")//props.data.room\n\n    let user_ = props.data.user; //{userName: props.data.user.userName} //props.data.user_\n\n    let isAdmin_ = room_.admin == user_.userName ? true : false;\n    let token_ = props.data.persistentToken ? props.data.persistentToken : null;\n    this.removeMessage = this.removeMessage.bind(this);\n    this.state = {\n      room: room_,\n      user: user_,\n      isAdmin: isAdmin_,\n      newMessage: \"\",\n      messages: [],\n      status: \"loading\"\n    };\n  }\n\n  componentDidMount() {\n    this.connectSocket();\n    this.socketEvents();\n  }\n\n  connectSocket() {\n    this.socket = io(\"http://192.168.1.9:3000\", {\n      transport: ['websocket']\n    });\n  }\n\n  set(field, value) {\n    this.setState({\n      [field]: value\n    });\n  }\n\n  socketEvents() {\n    //socket functions\n    this.socket.on('connect', connection => {\n      if (this.state.isAdmin) {\n        this.socket.emit('create-room', this.state.room.roomCode, this.state.room, thos.props.data.persistentToken);\n      } else {\n        this.socket.emit('join-room', this.state.room.roomCode, this.props.data.persistentToken);\n      }\n\n      console.log(\"connected.\");\n      this.socket.on('generated-user-token', tkn => {\n        console.log(tkn);\n        this.props.data.persistentToken = tkn;\n        localStorage.setItem(\"persistentToken\", tkn);\n      });\n      this.socket.on('backlog-messages', messages_ => {\n        this.set(\"messages\", messages_);\n        console.log(\"messages received: \", messages_);\n      });\n      this.socket.on('broadcasted-message', message => {\n        console.log(\"received: \", message);\n        console.log([...this.state.messages, message]);\n        this.set(\"messages\", [...this.state.messages, message]);\n        this.set(\"pending\", \"loaded\");\n      });\n      this.socket.on('room-ended', () => {\n        console.log(\"room ended. \");\n        this.socket.close();\n        this.detachFromRoom();\n      });\n      this.socket.on('removed-message', messages_ => {\n        this.set(\"messages\", messages_);\n        console.log(\"messages updated: \", messages_);\n      });\n      this.socket.on('find-and-ban-user', token => {\n        console.log(\"user has been banned.\");\n        if (token == this.props.data.token) this.leaveRoom();\n      });\n    });\n  }\n\n  setValue(setter, event) {\n    this.set(setter, event.target.value);\n  }\n\n  updateNewMessage(event) {\n    this.set(\"newMessage\", event.target.value);\n  }\n\n  sendMessage() {\n    this.socket.emit(\"broadcast-message\", this.state.room.roomCode, this.state.newMessage, this.state.user.userName, this.props.data.persistentToken);\n    this.set(\"newMessage\", \"\");\n  }\n\n  endRoom() {\n    this.socket.emit(\"end-room\", this.state.room.roomCode);\n    this.detachFromRoom();\n  }\n\n  detachFromRoom() {\n    this.socket.close();\n    this.socket = null;\n    this.set(\"room\", null);\n    this.set(\"status\", \"closed\");\n  }\n\n  leaveRoom() {\n    this.socket.emit(\"leave-room\", this.roomCode);\n    this.detachFromRoom();\n    this.props.history.push(\"/\");\n  }\n\n  removeUser(msg) {\n    this.socket.emit(\"ban-user\", msg);\n  }\n\n  exitClosedRoom() {\n    this.props.history.push(\"/\");\n  }\n\n  removeMessage(event) {\n    alert(\"user will be banned\");\n    this.socket.emit(\"ban-user\", this.roomCode, msg);\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      class: \"root\",\n      children: [this.state.room && this.state.status != \"closed\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n        class: \"chatroom-view\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          class: \"title-view\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            class: \"title-text\",\n            children: this.state.room.roomName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 170,\n            columnNumber: 21\n          }, this), this.state.isAdmin ? /*#__PURE__*/_jsxDEV(\"p\", {\n            class: \"title-leave-btn\",\n            onClick: this.endRoom.bind(this),\n            children: \"end room\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 25\n          }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n            class: \"title-leave-btn\",\n            onClick: this.leaveRoom.bind(this),\n            children: \"leave\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 173,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          class: \"chatroom-messages-view\",\n          children: this.state.messages ? /*#__PURE__*/_jsxDEV(\"div\", {\n            children: this.state.messages.map(msg => /*#__PURE__*/_jsxDEV(ChatMessage, {\n              onClick: () => this.removeMessage(msg),\n              text: msg.message,\n              userName: msg.userName,\n              isUser: this.state.user.userName == msg.userName\n            }, msg.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 184,\n              columnNumber: 29\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 21\n          }, this) : null\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          class: \"typed-message-view\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            value: this.state.newMessage,\n            onChange: event => this.setValue(\"newMessage\", event),\n            class: \"typed-message-input\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n            class: \"material-icons send-message-btn\",\n            onClick: this.sendMessage.bind(this),\n            children: \"\\uE163\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 197,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 194,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 17\n      }, this) : null, this.state.status == \"closed\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          class: \"title-leave-btn\",\n          onClick: this.exitClosedRoom.bind(this),\n          children: \"leave\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \" room is closed.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 13\n      }, this) : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default Chat;\n/*\n\n\n      //let roomCode_ = localStorage.getItem(\"room-code\")\n        let isAdmin_ = localStorage.getItem('create-room')\n        let roomName_ = localStorage.getItem(\"room-name\")\n        let userName_ = localStorage.getItem(\"user-name\")\n        let room_ = {\n            name:roomName_,\n            admin: userName_,\n            password:\"xxx\",\n            code: roomCode_\n        }\n\n\n                <ChatMessage\n                text={\"Hi, Sweet! So, what do you wanna do today?Sweet! \"}\n                userName=\"name\"\n                isUser={true}\n            ></ChatMessage>\n            <ChatMessage\n                text={\"Hi, Sweet! So, what do you wanna do today?Sweet! \"}\n                userName=\"name\"\n                isUser={false}\n            ></ChatMessage>\n                    <ChatMessage\n                text={\"Hi, Sweet! So, what do you wanna do today?Sweet! \"}\n                userName=\"name\"\n                isUser={true}\n            ></ChatMessage>\n            <ChatMessage\n                text={\"Hi, Sweet! So, what do you wanna do today?Sweet! \"}\n                userName=\"name\"\n                isUser={false}\n            ></ChatMessage>\n                                <ChatMessage\n                text={\"Hi, Sweet! So, what do you wanna do today?Sweet! \"}\n                userName=\"name\"\n                isUser={true}\n            ></ChatMessage>\n*/","map":{"version":3,"sources":["/Users/kitan/Documents/CODING/group-chat-react-project/group-chat-react/src/Chatroom/ChatRoom.js"],"names":["Room","Message","React","useState","useEffect","io","ChatMessage","Chat","Component","constructor","props","socket","room_","data","room","user_","user","isAdmin_","admin","userName","token_","persistentToken","removeMessage","bind","state","isAdmin","newMessage","messages","status","componentDidMount","connectSocket","socketEvents","transport","set","field","value","setState","on","connection","emit","roomCode","thos","console","log","tkn","localStorage","setItem","messages_","message","close","detachFromRoom","token","leaveRoom","setValue","setter","event","target","updateNewMessage","sendMessage","endRoom","history","push","removeUser","msg","exitClosedRoom","alert","render","roomName","map","id"],"mappings":"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","sourcesContent":["import './chatroom.css';\nimport Room from './RoomModel'\nimport Message from './MessageModel'\n\nimport React, { useState,  useEffect} from 'react';\nimport io from 'socket.io-client';\n\n\nimport ChatMessage from './ChatMessage';\n\n\n\n// \"bnh5yzdirjinqaorq0ox1tf383nb3xr\"\n\nclass Chat extends React.Component{\n\n\n    constructor(props){\n\n        super(props)\n\n        this.socket = null; \n\n        let room_ = props.data.room//new Room(\"25\", \"love isalnd ❤️\", \"kit\")//props.data.room\n        let user_ = props.data.user//{userName: props.data.user.userName} //props.data.user_\n        let isAdmin_ = room_.admin == user_.userName? true: false;\n        let token_= props.data.persistentToken? props.data.persistentToken: null;\n\n        this.removeMessage =this.removeMessage.bind(this)\n\n        this.state ={\n            room: room_,\n            user: user_,\n            isAdmin: isAdmin_,\n            newMessage: \"\",\n            messages: [],\n            status: \"loading\"\n        }\n\n        \n    }\n\n    \n    componentDidMount(){\n        this.connectSocket()\n        this.socketEvents()\n    }\n\n    connectSocket(){\n        this.socket = io(\"http://192.168.1.9:3000\", { transport: ['websocket']}) ;\n    }\n\n\n    set(field, value){\n        this.setState({[field]: value})\n    }\n\n    socketEvents(){\n\n        \n        //socket functions\n        this.socket.on('connect', (connection) => {\n           \n            if(this.state.isAdmin){\n                this.socket.emit('create-room', this.state.room.roomCode, this.state.room, thos.props.data.persistentToken)\n            }else{\n                this.socket.emit('join-room', this.state.room.roomCode,  this.props.data.persistentToken)\n            }\n            console.log(\"connected.\")\n\n            this.socket.on('generated-user-token', (tkn) => {\n                console.log(tkn)\n                this.props.data.persistentToken = tkn;\n                localStorage.setItem(\"persistentToken\", tkn)\n            });\n\n\n            this.socket.on('backlog-messages', (messages_) => {\n                this.set(\"messages\",messages_ )\n                console.log(\"messages received: \", messages_)\n            });\n\n            this.socket.on('broadcasted-message', (message) => {\n                console.log(\"received: \",message)\n                console.log([...this.state.messages,message])\n                this.set(\"messages\", [...this.state.messages,message])\n                this.set(\"pending\", \"loaded\")\n            });\n\n            this.socket.on('room-ended', () => {\n                console.log(\"room ended. \")\n                this.socket.close()\n                this.detachFromRoom()\n            });\n\n            this.socket.on('removed-message', (messages_) => {\n                this.set(\"messages\",messages_ )\n                console.log(\"messages updated: \", messages_)\n            });\n\n            this.socket.on('find-and-ban-user', (token) => {\n                console.log(\"user has been banned.\")\n                if(token == this.props.data.token)this.leaveRoom();\n            });\n\n        });\n\n   \n\n\n\n    }\n\n    setValue(setter, event){\n        this.set(setter, event.target.value)\n    }\n\n    updateNewMessage(event){\n        this.set(\"newMessage\" ,event.target.value)\n    }\n\n    sendMessage(){\n        this.socket.emit(\"broadcast-message\", this.state.room.roomCode, this.state.newMessage, this.state.user.userName, this.props.data.persistentToken)\n        this.set(\"newMessage\", \"\")\n    }\n\n    endRoom(){\n        this.socket.emit(\"end-room\", this.state.room.roomCode)\n        this.detachFromRoom()\n    }\n\n    detachFromRoom(){\n        this.socket.close()\n        this.socket = null;\n        this.set(\"room\",null)\n        this.set(\"status\", \"closed\")\n    }\n\n    leaveRoom(){\n        this.socket.emit(\"leave-room\", this.roomCode)\n        this.detachFromRoom();\n        this.props.history.push(\"/\")\n    }\n\n    removeUser(msg){\n        this.socket.emit(\"ban-user\", msg)\n    }\n    \n    exitClosedRoom(){\n        this.props.history.push(\"/\")\n    }\n\n    removeMessage(event){\n        alert(\"user will be banned\")\n        this.socket.emit(\"ban-user\", this.roomCode, msg)\n    }\n\n\n\n  \n    render(){\n\n        return (\n            <div class=\"root\">\n            {this.state.room && this.state.status != \"closed\"?\n                <div class=\"chatroom-view\">\n                \n                <div class=\"title-view\">\n     \n                    <p class=\"title-text\">{this.state.room.roomName}</p>\n                    {this.state.isAdmin?\n                        <p class=\"title-leave-btn\"  onClick={this.endRoom.bind(this)}>end room</p>:\n                        <p class=\"title-leave-btn\"  onClick={this.leaveRoom.bind(this)}>leave</p>\n                    }\n\n        \n                </div>\n              \n                <div class=\"chatroom-messages-view\">\n            \n                    {this.state.messages?\n                    <div>\n                        {this.state.messages.map(msg=> \n                            <ChatMessage \n                                onClick={()=> this.removeMessage(msg)} \n                                key={msg.id} text={msg.message} \n                                userName={msg.userName } \n                                isUser={this.state.user.userName == msg.userName}/>)}\n                        </div>\n                        :null\n                    }\n        \n                    </div>\n                    <div class=\"typed-message-view\">\n                    \n                        <input  type=\"text\" value={this.state.newMessage} onChange={(event)=> this.setValue(\"newMessage\", event) }class=\"typed-message-input\"></input>\n                        <i class=\"material-icons send-message-btn\" onClick={this.sendMessage.bind(this)}>&#xe163;</i>\n        \n        \n                    </div>\n        \n                </div>\n                :null\n            }\n\n            {this.state.status == \"closed\"?\n            <div>\n                <p class=\"title-leave-btn\"  onClick={this.exitClosedRoom.bind(this)}>leave</p>\n                <p> room is closed.</p>\n            </div>:\n                null\n            }\n            </div>\n        );\n        \n    }\n    \n}\n\nexport default Chat;\n\n\n\n/*\n\n\n      //let roomCode_ = localStorage.getItem(\"room-code\")\n        let isAdmin_ = localStorage.getItem('create-room')\n        let roomName_ = localStorage.getItem(\"room-name\")\n        let userName_ = localStorage.getItem(\"user-name\")\n        let room_ = {\n            name:roomName_,\n            admin: userName_,\n            password:\"xxx\",\n            code: roomCode_\n        }\n\n\n                <ChatMessage\n                text={\"Hi, Sweet! So, what do you wanna do today?Sweet! \"}\n                userName=\"name\"\n                isUser={true}\n            ></ChatMessage>\n            <ChatMessage\n                text={\"Hi, Sweet! So, what do you wanna do today?Sweet! \"}\n                userName=\"name\"\n                isUser={false}\n            ></ChatMessage>\n                    <ChatMessage\n                text={\"Hi, Sweet! So, what do you wanna do today?Sweet! \"}\n                userName=\"name\"\n                isUser={true}\n            ></ChatMessage>\n            <ChatMessage\n                text={\"Hi, Sweet! So, what do you wanna do today?Sweet! \"}\n                userName=\"name\"\n                isUser={false}\n            ></ChatMessage>\n                                <ChatMessage\n                text={\"Hi, Sweet! So, what do you wanna do today?Sweet! \"}\n                userName=\"name\"\n                isUser={true}\n            ></ChatMessage>\n*/"]},"metadata":{},"sourceType":"module"}