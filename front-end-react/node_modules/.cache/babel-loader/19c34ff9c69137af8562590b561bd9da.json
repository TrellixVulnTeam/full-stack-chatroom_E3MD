{"ast":null,"code":"var _jsxFileName = \"/Users/kitan/Documents/CODING/Long-term-projects/group-chat-react-project/group-chat-react/src/Chatroom/ChatRoom.js\";\nimport './chatroom.css';\nimport { withRouter } from 'react-router-dom';\nimport React from 'react';\nimport io from 'socket.io-client';\nimport ChatMessage from './ChatMessage';\nimport SocketManager from './Socket';\nimport { FaTelegramPlane } from \"react-icons/fa\"; // \"bnh5yzdirjinqaorq0ox1tf383nb3xr\"\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass Chat extends React.Component {\n  constructor(props) {\n    super(props);\n    this.socket = null;\n    if (!props.data.room) props.history.push(\"/\");\n    let room_ = props.data.room; //new Room(\"25\", \"love isalnd ❤️\", \"kit\")//props.data.room\n\n    let user_ = props.data.user; //{userName: props.data.user.userName} //props.data.user_\n\n    let isAdmin_ = room_ ? room_.admin === user_.userName ? true : false : null; //==\n\n    let token_ = props.data.persistentToken ? props.data.persistentToken : null;\n    console.log(\"token is: \", token_);\n    this.removeMessage = this.removeMessage.bind(this);\n    this.onAddReaction = this.onAddReaction.bind(this);\n    this.state = {\n      room: room_,\n      user: user_,\n      isAdmin: isAdmin_,\n      newMessage: \"\",\n      messages: [],\n      status: \"loading\"\n    };\n    if (!this.state.room) this.props.history.push(\"/\");\n  }\n\n  componentDidMount() {\n    if (!this.state.room) this.props.history.push(\"/\");else {\n      this.connectSocket();\n      this.socketEvents();\n    }\n    this.textarea.focus();\n    autosize(this.textarea);\n  }\n\n  connectSocket() {\n    this.socket = io(\"http://192.168.1.9:3000\", {\n      transport: ['websocket']\n    });\n  }\n\n  set(field, value) {\n    this.setState({\n      [field]: value\n    });\n  }\n\n  socketEvents() {\n    //socket functions\n    this.socket.on('connect', connection => {\n      if (this.state.isAdmin) {\n        SocketManager.createRoom(this);\n      } else {\n        this.socket.emit('join-room', this.state.room.roomCode, this.props.data.persistentToken);\n      }\n\n      console.log(\"connected.\");\n      this.socket.on('generated-user-token', tkn => {\n        this.props.data.persistentToken = tkn;\n        localStorage.setItem(\"persistentToken\", tkn);\n        console.log(\"new token generated: \", tkn);\n      });\n      this.socket.on('backlog-messages', messages_ => {\n        this.set(\"messages\", messages_);\n        this.set(\"status\", \"loaded\");\n      });\n      this.socket.on('broadcasted-message', message => {\n        this.set(\"messages\", [...this.state.messages, message]);\n      });\n      this.socket.on('room-ended', () => {\n        console.log(\"room ended. \");\n        this.socket.close();\n        this.detachFromRoom();\n      });\n      this.socket.on('removed-message', messages_ => {\n        this.set(\"messages\", messages_);\n        console.log(\"messages updated: \", messages_);\n      });\n      this.socket.on('update-message', messages_ => {\n        this.set(\"messages\", messages_);\n        console.log(\"messages updated: \", messages_);\n      });\n      this.socket.on('find-and-ban-user', token => {\n        console.log(\"user has been banned.\");\n        console.log(token === this.props.data.persistentToken);\n        console.log(token, this.props.data.persistentToken);\n\n        if (token === this.props.data.persistentToken) {\n          this.detachFromRoom();\n          this.set(\"status\", \"banned\");\n        }\n      });\n    });\n  }\n\n  setValue(setter, event) {\n    this.set(setter, event.target.value);\n  }\n\n  updateNewMessage(event) {\n    this.set(\"newMessage\", event.target.value);\n  }\n\n  sendMessage() {\n    this.socket.emit(\"broadcast-message\", this.state.room.roomCode, this.state.newMessage, this.state.user.userName, this.props.data.persistentToken);\n    this.set(\"newMessage\", \"\");\n  }\n\n  endRoom() {\n    this.socket.emit(\"end-room\", this.state.room.roomCode);\n    this.detachFromRoom();\n  }\n\n  detachFromRoom() {\n    this.set(\"room\", null);\n    this.socket.close();\n    this.socket = null;\n    this.set(\"status\", \"closed\");\n  }\n\n  leaveRoom() {\n    this.socket.emit(\"leave-room\", this.roomCode);\n    this.detachFromRoom();\n    this.props.history.push(\"/\");\n  }\n\n  removeUser(msg) {}\n\n  exitClosedRoom() {\n    this.props.history.push(\"/\");\n  }\n\n  removeMessage(msg) {\n    alert(\"user will be banned\");\n    console.log(msg, this.state.room.roomCode, msg);\n    this.socket.emit(\"ban-user\", this.state.room.roomCode, msg);\n  }\n\n  onAddReaction(emoji, msg) {\n    this.socket.emit(\"add-reaction\", this.state.room.roomCode, msg, emoji);\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      class: \"root\",\n      children: [this.state.room && this.state.status !== \"closed\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n        class: \"chatroom-view\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          class: \"title-view\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            class: \"title-text\",\n            children: this.state.room.roomName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 202,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            class: \"leave-text\",\n            children: \"leave\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          class: \"chatroom-messages-view\",\n          children: this.state.messages ? /*#__PURE__*/_jsxDEV(\"div\", {\n            children: this.state.messages.map(msg => /*#__PURE__*/_jsxDEV(ChatMessage, {\n              onClick: () => this.removeMessage(msg),\n              onReportMessage: this.removeMessage,\n              message: msg,\n              text: msg.message,\n              userName: msg.userName,\n              reactions: msg.reactions,\n              onAddReaction: emoji => this.onAddReaction(emoji, msg),\n              isUser: this.state.user.userName === msg.userName\n            }, msg.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 217,\n              columnNumber: 25\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 21\n          }, this) : null\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 212,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          class: \"typed-message-view\",\n          children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n            class: \"typed-message-input\",\n            ref: c => this.textarea = c,\n            placeholder: \"type some text\",\n            rows: 1,\n            defaultValue: \"\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 234,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            value: this.state.newMessage,\n            onChange: event => this.setValue(\"newMessage\", event),\n            class: \"typed-message-input\",\n            name: \"text\",\n            rows: \"3\",\n            cols: \"20\",\n            wrap: \"hard\",\n            type: \"text\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"i\", {\n            class: \"material-icons send-message-btn\",\n            onClick: this.sendMessage.bind(this),\n            children: /*#__PURE__*/_jsxDEV(FaTelegramPlane, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 253,\n              columnNumber: 26\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 251,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 17\n      }, this) : null, this.state.status === \"closed\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          class: \"title-leave-btn\",\n          onClick: this.exitClosedRoom.bind(this),\n          children: \"leave\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \" room is closed.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 13\n      }, this) : null, this.state.status === \"banned\" ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          class: \"title-leave-btn\",\n          onClick: this.exitClosedRoom.bind(this),\n          children: \"leave\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 270,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \" you've been removed.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 13\n      }, this) : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default _c = withRouter(Chat);\n\nvar _c;\n\n$RefreshReg$(_c, \"%default%\");","map":{"version":3,"sources":["/Users/kitan/Documents/CODING/Long-term-projects/group-chat-react-project/group-chat-react/src/Chatroom/ChatRoom.js"],"names":["withRouter","React","io","ChatMessage","SocketManager","FaTelegramPlane","Chat","Component","constructor","props","socket","data","room","history","push","room_","user_","user","isAdmin_","admin","userName","token_","persistentToken","console","log","removeMessage","bind","onAddReaction","state","isAdmin","newMessage","messages","status","componentDidMount","connectSocket","socketEvents","textarea","focus","autosize","transport","set","field","value","setState","on","connection","createRoom","emit","roomCode","tkn","localStorage","setItem","messages_","message","close","detachFromRoom","token","setValue","setter","event","target","updateNewMessage","sendMessage","endRoom","leaveRoom","removeUser","msg","exitClosedRoom","alert","emoji","render","roomName","map","reactions","id","c"],"mappings":"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","sourcesContent":["import './chatroom.css';\nimport { withRouter} from 'react-router-dom';\n\nimport React from 'react';\nimport io from 'socket.io-client';\n\n\nimport ChatMessage from './ChatMessage';\nimport SocketManager from './Socket'\n\nimport { FaTelegramPlane } from \"react-icons/fa\";\n\n\n\n\n\n\n// \"bnh5yzdirjinqaorq0ox1tf383nb3xr\"\n\nclass Chat extends React.Component{\n\n\n    constructor(props){\n\n        super(props)\n\n        this.socket = null; \n\n        if(!props.data.room) props.history.push(\"/\")\n\n        let room_ = props.data.room//new Room(\"25\", \"love isalnd ❤️\", \"kit\")//props.data.room\n        let user_ = props.data.user//{userName: props.data.user.userName} //props.data.user_\n        let isAdmin_ = room_ ?  (room_.admin === user_.userName? true: false):null //==\n        let token_= props.data.persistentToken? props.data.persistentToken: null;\n        console.log(\"token is: \", token_)\n\n        this.removeMessage =this.removeMessage.bind(this)\n        this.onAddReaction = this.onAddReaction.bind(this)\n\n        this.state ={\n            room: room_,\n            user: user_,\n            isAdmin: isAdmin_,\n            newMessage: \"\",\n            messages: [],\n            status: \"loading\"\n        }\n\n        if(!this.state.room)this.props.history.push(\"/\")\n        \n    }\n\n    \n    componentDidMount(){\n        if(!this.state.room)this.props.history.push(\"/\")\n        else{\n            this.connectSocket()\n            this.socketEvents()\n        }\n        this.textarea.focus();\n        autosize(this.textarea);\n    }\n\n    connectSocket(){\n        this.socket = io(\"http://192.168.1.9:3000\", { transport: ['websocket']}) ;\n    }\n\n\n    set(field, value){\n        this.setState({[field]: value})\n    }\n\n    socketEvents(){\n\n        \n        //socket functions\n        this.socket.on('connect', (connection) => {\n           \n            if(this.state.isAdmin){\n                SocketManager.createRoom(this)\n            }else{\n                this.socket.emit('join-room', this.state.room.roomCode,  this.props.data.persistentToken)\n            }\n            console.log(\"connected.\")\n\n            this.socket.on('generated-user-token', (tkn) => {\n                this.props.data.persistentToken = tkn;\n                localStorage.setItem(\"persistentToken\", tkn)\n                console.log(\"new token generated: \",tkn)\n            });\n\n\n            this.socket.on('backlog-messages', (messages_) => {\n                this.set(\"messages\",messages_ )\n                this.set(\"status\", \"loaded\")\n\n            });\n\n            this.socket.on('broadcasted-message', (message) => {\n                this.set(\"messages\", [...this.state.messages,message])\n            });\n\n            this.socket.on('room-ended', () => {\n                console.log(\"room ended. \")\n                this.socket.close()\n                this.detachFromRoom()\n            });\n\n            this.socket.on('removed-message', (messages_) => {\n                this.set(\"messages\",messages_ )\n                console.log(\"messages updated: \", messages_)\n            });\n\n            this.socket.on('update-message', (messages_) => {\n                this.set(\"messages\",messages_ )\n                console.log(\"messages updated: \", messages_)\n            });\n\n            this.socket.on('find-and-ban-user', (token) => {\n                console.log(\"user has been banned.\")\n                console.log(token === this.props.data.persistentToken)\n                console.log(token, this.props.data.persistentToken)\n\n                \n                if(token === this.props.data.persistentToken){\n                    this.detachFromRoom();\n                    this.set(\"status\",\"banned\" )\n\n                }\n            });\n\n        });\n\n   \n\n\n\n    }\n\n    setValue(setter, event){\n        this.set(setter, event.target.value)\n    }\n\n    updateNewMessage(event){\n        this.set(\"newMessage\" ,event.target.value)\n    }\n\n    sendMessage(){\n        this.socket.emit(\"broadcast-message\", this.state.room.roomCode, this.state.newMessage, this.state.user.userName, this.props.data.persistentToken)\n        this.set(\"newMessage\", \"\")\n    }\n\n    endRoom(){\n        this.socket.emit(\"end-room\", this.state.room.roomCode)\n        this.detachFromRoom()\n    }\n\n    detachFromRoom(){\n        this.set(\"room\",null)\n        this.socket.close()\n        this.socket = null;\n        this.set(\"status\", \"closed\")\n    }\n\n    leaveRoom(){\n        this.socket.emit(\"leave-room\", this.roomCode)\n        this.detachFromRoom();\n        this.props.history.push(\"/\")\n    }\n\n    removeUser(msg){\n       \n        \n    }\n    \n    exitClosedRoom(){\n        this.props.history.push(\"/\")\n    }\n\n    removeMessage(msg){\n        alert(\"user will be banned\")\n        console.log(msg,  this.state.room.roomCode, msg)\n        this.socket.emit(\"ban-user\", this.state.room.roomCode, msg)\n    }\n\n    onAddReaction(emoji, msg){\n        this.socket.emit(\"add-reaction\", this.state.room.roomCode, msg, emoji)\n    }\n\n\n\n  \n    render(){\n\n        return (\n            <div class=\"root\">\n            {this.state.room && this.state.status !== \"closed\" ?\n                <div class=\"chatroom-view\">\n                \n                <div class=\"title-view\">\n     \n                    <span class=\"title-text\">{this.state.room.roomName}</span>\n                    {/*this.state.isAdmin?\n                        <p class=\"title-leave-btn\"  onClick={this.endRoom.bind(this)}>end room</p>:\n                        <p class=\"title-leave-btn\"  onClick={this.leaveRoom.bind(this)}>leave</p>\n                    */ }\n                    <span class=\"leave-text\">leave</span>\n\n        \n                </div>\n              \n                <div class=\"chatroom-messages-view\">\n            \n                    {this.state.messages?\n                    <div>\n                        {this.state.messages.map(msg=> \n                        <ChatMessage \n                            onClick={()=> this.removeMessage(msg)} \n                            onReportMessage={this.removeMessage}\n                            message ={msg}\n                            key={msg.id} \n                            text={msg.message} \n                            userName={msg.userName } \n                            reactions = {msg.reactions}\n                            onAddReaction={(emoji=>this.onAddReaction(emoji, msg))}\n                            isUser={this.state.user.userName === msg.userName}/>)}\n                    </div>\n                        :null\n                    }\n        \n                    </div>\n\n                    <div class=\"typed-message-view\">\n                    <textarea\n                                                class=\"typed-message-input\"\n\n                        ref={c => (this.textarea = c)}\n                        placeholder=\"type some text\"\n                        rows={1}\n                        defaultValue=\"\"\n                        />\n       \n                        <textarea  \n                     \n                        value={this.state.newMessage} \n                        onChange={(event)=> this.setValue(\"newMessage\", event) }\n                        class=\"typed-message-input\"\n                        name=\"text\" \n                        rows=\"3\" \n                        cols=\"20\" wrap=\"hard\" type=\"text\" ></textarea>\n                        <i class=\"material-icons send-message-btn\" \n                            onClick={this.sendMessage.bind(this)}\n                        ><FaTelegramPlane/></i>\n                    </div>\n        \n                </div>\n                :null\n            }\n\n            {this.state.status === \"closed\"?\n            <div>\n                <p class=\"title-leave-btn\"  onClick={this.exitClosedRoom.bind(this)}>leave</p>\n                <p> room is closed.</p>\n            </div>:\n                null\n            }\n\n            {this.state.status === \"banned\"?\n            <div>\n                <p class=\"title-leave-btn\"  onClick={this.exitClosedRoom.bind(this)}>leave</p>\n                <p> you've been removed.</p>\n            </div>:\n                null\n            }\n            </div>\n        );\n        \n    }\n    \n}\n\nexport default withRouter(Chat);\n"]},"metadata":{},"sourceType":"module"}