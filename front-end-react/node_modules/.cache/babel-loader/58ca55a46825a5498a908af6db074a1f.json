{"ast":null,"code":"//FIREBASE CONFIG//\nimport firebase from 'firebase';\nimport 'firebase/firestore';\nimport UserService from './UserService';\nvar firebaseConfig = {\n  apiKey: process.env.REACT_APP_apiKey,\n  authDomain: process.env.REACT_APP_authDomain,\n  projectId: process.env.REACT_APP_projectId,\n  storageBucket: process.env.REACT_APP_storageBucket,\n  messagingSenderId: process.env.REACT_APP_messagingSenderId,\n  appId: process.env.REACT_APP_appId,\n  measurementId: process.env.REACT_APP_measurementId\n};\nfirebase.initializeApp(firebaseConfig); //DATABASE INIT\n\nconst firestore = firebase.firestore();\nvar database = firebase.database();\nconst chatroomsDB = firestore.collection('chatrooms');\nconst usersDB = firestore.collection('users'); //const messagesRef = firestore.collection('messages');\n//Functional groups\n\nclass FirebaseUtil {\n  static async getUserToken() {\n    if (!UserService.getUserID()) {\n      let userID = await usersDB.add({\n        name: \"none\",\n        type: \"annon\"\n      }).then(res => {\n        UserService.setUserID(res.id); //localStorage.setItem(\"user-token\", res.id)\n\n        console.log(\"generating new profile: \", res.id);\n        return res.id;\n      });\n      return userID;\n    } else {\n      console.log(\"returning user: \", UserService.getUserID());\n      return UserService.getUserID();\n    }\n  }\n\n  static async findRoomById(roomID) {\n    let room;\n    console.log(roomID);\n    await chatroomsDB.doc(roomID).get().then(doc => {\n      console.log(doc);\n\n      if (doc) {\n        room = doc.data();\n        room.roomID = doc.id;\n      }\n    });\n    console.log(room);\n    return room;\n  }\n\n  static async createRoom(roomName, adminID) {\n    let code = stringGen(6);\n    chatroomsDB.get().then(querySnapshot => {\n      let duplicatedCode = true;\n\n      do {\n        code = stringGen(6); //querySnapshot.docs.forEach(doc => null)\n\n        duplicatedCode = querySnapshot.docs.find(doc => doc.data().code == code);\n        console.log(\"code is: \", code);\n      } while (duplicatedCode);\n\n      console.log(\"code is not duplicated: \", code);\n    }).catch(error => {\n      console.log(\"Error getting documents: \", error);\n    });\n    let room = {\n      adminID: adminID,\n      roomName: roomName,\n      roomCode: code,\n      type: \"temporary\",\n      timeStamp: \"\" //firestore.FieldValue.serverTimestamp()\n\n    };\n    await chatroomsDB.add(room).then(doc => room.roomID = doc.id);\n    return room; //return apiCompletionPromise\n  }\n\n}\n\nexport { FirebaseUtil };\n\nfunction stringGen(len) {\n  var text = \"\";\n  var charset = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n\n  for (var i = 0; i < len; i++) text += charset.charAt(Math.floor(Math.random() * charset.length));\n\n  return text;\n}","map":{"version":3,"sources":["/Users/kitan/Documents/CODING/Long-term-projects/group-chat-react-project/group-chat-react/src/FirebaseUtil/FirebaseUtil.js"],"names":["firebase","UserService","firebaseConfig","apiKey","process","env","REACT_APP_apiKey","authDomain","REACT_APP_authDomain","projectId","REACT_APP_projectId","storageBucket","REACT_APP_storageBucket","messagingSenderId","REACT_APP_messagingSenderId","appId","REACT_APP_appId","measurementId","REACT_APP_measurementId","initializeApp","firestore","database","chatroomsDB","collection","usersDB","FirebaseUtil","getUserToken","getUserID","userID","add","name","type","then","res","setUserID","id","console","log","findRoomById","roomID","room","doc","get","data","createRoom","roomName","adminID","code","stringGen","querySnapshot","duplicatedCode","docs","find","catch","error","roomCode","timeStamp","len","text","charset","i","charAt","Math","floor","random","length"],"mappings":"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","sourcesContent":["\n//FIREBASE CONFIG//\nimport firebase from 'firebase';\nimport 'firebase/firestore';\nimport UserService from './UserService'\n\n\nvar firebaseConfig = {\n    apiKey: process.env.REACT_APP_apiKey,\n    authDomain: process.env.REACT_APP_authDomain,\n    projectId: process.env.REACT_APP_projectId,\n    storageBucket: process.env.REACT_APP_storageBucket,\n    messagingSenderId: process.env.REACT_APP_messagingSenderId,\n    appId: process.env.REACT_APP_appId,\n    measurementId: process.env.REACT_APP_measurementId\n};\n  \nfirebase.initializeApp(firebaseConfig)\n\n\n//DATABASE INIT\nconst firestore = firebase.firestore();\nvar database = firebase.database();\n\nconst chatroomsDB = firestore.collection('chatrooms');\nconst usersDB = firestore.collection('users');\n//const messagesRef = firestore.collection('messages');\n\n\n//Functional groups\nclass FirebaseUtil  {\n\n     static async getUserToken(){\n\n          if(!UserService.getUserID()){\n  \n              let userID = await usersDB.add({\n                  name: \"none\",\n                  type: \"annon\"\n              }).then(res =>{\n                  UserService.setUserID(res.id)\n                  //localStorage.setItem(\"user-token\", res.id)\n                  console.log(\"generating new profile: \", res.id)\n                  return res.id\n              })\n              return userID\n\n          }else{\n                console.log(\"returning user: \",UserService.getUserID())\n                return UserService.getUserID();\n          }\n    }\n    \n    static async findRoomById(roomID){\n\n        let room;\n        console.log(roomID)\n        await chatroomsDB.doc(roomID).get().then((doc) => {\n\n            console.log(doc)\n            if(doc){\n                 room =doc.data()\n                 room.roomID = doc.id\n            }\n        })\n\n        console.log(room)\n\n        return room\n        \n    }\n    static async createRoom( roomName, adminID){\n\n        let code = stringGen(6);\n        chatroomsDB.get().then((querySnapshot) => {\n\n            let duplicatedCode = true;\n            do{\n                code = stringGen(6);\n                //querySnapshot.docs.forEach(doc => null)\n                duplicatedCode = querySnapshot.docs.find(doc => (doc.data()).code == code)\n                console.log(\"code is: \",code)\n            }while(duplicatedCode)\n\n            console.log(\"code is not duplicated: \",code)\n\n        }).catch((error) => {\n                console.log(\"Error getting documents: \", error);\n        })\n\n        let room = {\n            adminID: adminID,\n            roomName: roomName,\n            roomCode: code,\n            type: \"temporary\",\n            timeStamp: \"\"//firestore.FieldValue.serverTimestamp()\n        }\n\n        await chatroomsDB.add(room).then(doc => room.roomID = doc.id)\n\n        return room\n        //return apiCompletionPromise\n          \n        \n\n      \n\n  }\n\n\n\n}\n\n\nexport {\n    FirebaseUtil\n}\n\nfunction stringGen(len) {\n    var text = \"\";\n    \n    var charset = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789\";\n    \n    for (var i = 0; i < len; i++)\n        text += charset.charAt(Math.floor(Math.random() * charset.length));\n    \n    return text;\n    }"]},"metadata":{},"sourceType":"module"}